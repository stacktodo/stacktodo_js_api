/**
* Stacktodo JavaScript API. Version 0.0.3.
* https://github.com/stacktodo/stacktodo_js_api
* MIT License
*/
!function(t){var e=function(){var t=this;return t.serialize=function(t){for(var e={},o={input:t.getElementsByTagName("input"),textarea:t.getElementsByTagName("textarea"),select:t.getElementsByTagName("select")},n=0;n<o.input.length;n++){var r=o.input[n].name;if(void 0!==r&&0!==r.length){var i=o.input[n].type;"checkbox"===i?o.input[n].checked&&(e[r]=e[r]||[],e[r].push(o.input[n].value)):"radio"===i?o.input[n].checked&&(e[r]=e[o.input[n].value]):(e[r]=e[r]||[],e[r].push(o.input[n].value))}}for(var a=0;a<o.textarea.length;a++){var r=o.textarea[a].name;void 0!==r&&0!==r.length&&(e[r]=e[r]||[],e[r].push(o.textarea[a].value))}for(var u=0;n<o.select.length;u++){var r=o.select[u].name;if(void 0!==r&&0!==r.length)for(var s=o.select[u].getElementsByTagName("option"),c=0;c<s.length;c++)if(s[c].selected){e[r]=e[r]||[],e[r].push(s[c].value);break}}for(var l in e)1===e[l].length&&(e[l]=e[l][0]);return e},t};t.stacktodo=t.stacktodo||{},t.stacktodo.core=t.stacktodo.core||{},t.stacktodo.core.form=new e}(window),function(t){var e=function(){var t=this,e="withCredentials"in new XMLHttpRequest||"undefined"!=typeof XDomainRequest,o=function(t){var e=[];for(var o in t)e.push(encodeURIComponent(o)+"="+encodeURIComponent(t[o]));return e.join("&")};return t.requestCORS=function(t,e,o,n,r){e=e.toUpperCase();var i;return"undefined"!=typeof XDomainRequest?(i=new XDomainRequest,i.open(e,t)):(i=new XMLHttpRequest,i.open(e,t,!0)),i.onload=function(){var t;try{t=JSON.parse(i.responseText)}catch(e){}var o=t&&void 0!==t.http_status?t.http_status:i.status;o>=200&&299>=o?n(t,o,i):r(i.status,t?t.error:void 0,i)},i.onerror=function(){r(i.status,void 0,i)},"POST"===e?(i.setRequestHeader("Content-type","application/json"),i.send(JSON.stringify(o))):i.send(),i},t.requestJSONP=function(t,e,n,r,i){e=e.toUpperCase();var a=document.createElement("script");a.type="text/javascript";var u="__jsonp_"+Math.ceil(1e4*Math.random()),s={jsonp:!0,id:u,response:void 0};window[u]=function(t){a.parentElement.removeChild(a),delete window[u],s.response=t,void 0===t||null===t?r(void 0,200,s):t.http_status>=200&&t.http_status<=299?r(t,t.http_status,s):i(t.http_status,t.error,s)},a.onerror=function(){a.parentElement.removeChild(a),s.jsonp_transport_error="ScriptErrorFailure",i(0,void 0,s)};var c;return c="POST"===e?"?"+o(n)+"&callback="+u+"&_="+(new Date).getTime():"?callback="+u+"&_="+(new Date).getTime(),a.src=t+c,document.head.appendChild(a),s},t.get=function(o){var n=e?"requestCORS":"requestJSONP";return t[n](o.url||window.location.href,"GET",void 0,function(t,e,n){o.success&&o.success(t,e,n),o.complete&&o.complete()},function(t,e,n){o.failure&&o.failure(t,e,n),o.complete&&o.complete()})},t.post=function(o){var n=e?"requestCORS":"requestJSONP";return t[n](o.url||window.location.href,"POST",o.payload||{},function(t,e,n){o.success&&o.success(t,e,n),o.complete&&o.complete()},function(t,e,n){o.failure&&o.failure(t,e,n),o.complete&&o.complete()})},t};t.stacktodo=t.stacktodo||{},t.stacktodo.core=t.stacktodo.core||{},t.stacktodo.core.jsoncors=new e}(window),function(t){var e=function(){var t=this;return t.get=function(t){t={url:t.url||window.location.href,success:t.success||function(){},failure:t.failure||function(){},complete:t.complete||function(){}};var e;return"undefined"!=typeof XDomainRequest?(e=new XDomainRequest,e.open("GET",t.url)):(e=new XMLHttpRequest,e.open("GET",t.url,!0)),e.onload=function(){e.status>=200&&e.status<=299?t.success(e.responseText,e.status,e):t.failure(e.status,e.responseText,e),t.complete()},e.onerror=function(){t.failure(e.status,void 0,e),t.complete()},e.send(),e},t};t.stacktodo=t.stacktodo||{},t.stacktodo.core=t.stacktodo.core||{},t.stacktodo.core.ajax=new e}(window),function(t){var e=function(){var t=this;return t.urlArg=function(t,e){e=e||window.location.href,t=t.replace(/[\[]/,"\\[").replace(/[\]]/,"\\]");var o="[\\?&]"+t+"=([^&#]*)",n=new RegExp(o),r=n.exec(e);return null==r?void 0:decodeURIComponent(r[1])},t};t.stacktodo=t.stacktodo||{},t.stacktodo.core=t.stacktodo.core||{},t.stacktodo.core.qs=new e}(window),function(t){var e=function(){var t=this;return t.UNFURL_TYPES={IMAGE:"image",ANY:void 0},t.isSlackFileUrl=function(t){return 0===t.indexOf("https://files.slack.com/")?!0:0===t.indexOf("https://slack-files.com/")?!0:0===t.indexOf("https://")&&-1!==t.indexOf("slack.com/files/")?!0:!1},t.generateUnfurlUrl=function(t,e){var o="url="+encodeURIComponent(t);return o+=void 0===e?"":"&allowed="+encodeURIComponent(e),"https://stacktodo.com/api/slack/resource/unfurl/file?"+o},t};t.stacktodo=t.stacktodo||{},t.stacktodo.slackFiles=new e}(window),function(t){var e=function(e){var o=this;return o.ERRORS={EmptyFormError:"EmptyFormError",UnknownFormError:"UnknownFormError",UnknownError:"UnknownError"},o.HUMANIZED_ERRORS={EmptyFormError:"Looks like you forgot to complete the form. Can you check it and try again?",UnknownFormError:"We couldn't find the form channel you're trying to send to :-(",UnknownError:"Something went wrong and we're not quite sure what. We'll look into it as soon as possible!"},o.humanizeError=function(t){return o.HUMANIZED_ERRORS[t]||o.HUMANIZED_ERRORS.UNKNOWN_ERROR},o.preValidate=function(t){for(var e in t)return null;return o.ERRORS.EmptyFormError},o.submit=function(n,r,i,a){r=r||function(){},i=i||function(){},a=a||function(){};var u=t.stacktodo.core.form.serialize(n),s=o.preValidate(n);null===s?t.stacktodo.core.jsoncors.post({url:"https://stacktodo.com/api/tool/form/submit",payload:{id:e,form:u},success:function(t,e,o){r(),a()},failure:function(t,e,n){if(!e)switch(t){case 404:e=o.ERRORS.UnknownFormError;break;default:e=o.ERRORS.UnknownError}i(e),a()}}):(i(s),a())},this};t.stacktodo=t.stacktodo||{},t.stacktodo.SlackForm=e}(window),function(t){var e=function(e){var o=this;o.ERRORS={MissingEmailError:"MissingEmailError",InvalidEmailError:"InvalidEmailError",UnknownTeamError:"UnknownTeamError",UnknownError:"UnknownError"},o.STATUSES={RequestedAuthState:"RequestedAuthState",InvitedUserState:"InvitedUserState"},o.HUMANIZED_ERRORS={MissingEmailError:"Your email is looking awfully blank, if you fill it in we can get you started",InvalidEmailError:"Your email doesn't quite look right. Can you check it and try again?",UnknownTeamError:"We couldn't find the team you're trying to join :-(",UnknownError:"Something went wrong and we're not quite sure what. We'll look into it as soon as possible!"},o.HUMANIZED_STATUSES={RequestedAuthState:"Awesome your email address has been sent for approval. You should receive an invitation email from slack once you've been approved",InvitedUserState:"Awesome you've been invited into the team. Check your inbox for the invitation email from slack!"},o.humanizeError=function(t){return o.HUMANIZED_ERRORS[t]||o.HUMANIZED_ERRORS.UNKNOWN_ERROR},o.humanizeStatus=function(t){return o.HUMANIZED_STATUSES[t]||o.HUMANIZED_ERRORS.UNKNOWN_ERROR},o.preValidate=function(t){return t&&0!==t.length?-1===t.indexOf("@")||t.length<7?o.ERRORS.InvalidEmailError:null:o.ERRORS.MissingEmailError};var n=function(t,e){for(var o in e)t[o]=e[o];return t};return o.join=function(r,i,a,u,s){a=a||function(){},u=u||function(){},s=s||function(){};var c=o.preValidate(r);null===c?t.stacktodo.core.jsoncors.post({url:"https://stacktodo.com/api/tool/invite/join",payload:n(i,{email:r,team:e}),success:function(t,e,o){a(t.state),s()},failure:function(t,e,n){if(!e)switch(t){case 404:e=o.ERRORS.UnknownTeamError;break;default:e=o.ERRORS.UnknownError}u(e),s()}}):(u(c),s())},o};t.stacktodo=t.stacktodo||{},t.stacktodo.SlackInvite=e}(window),function(t){var e=function(){var e=this,o=function(t){switch(t.length){case 1:return"?id="+encodeURIComponent(t[0]);case 2:return"?team="+encodeURIComponent(t[0])+"&reference="+encodeURIComponent(t[1]);default:throw"InitializationError : Incorrect params"}}(Array.prototype.slice.call(arguments)),n=null,r={};return e.loaded=function(){return null!==n},e.count=function(){return null===n?void 0:n.length},e.postHeadForId=function(t){for(var e=0;e<(n||[]).length;e++)if(n[e].id===t)return n[e];return void 0},e.postHeadForIndex=function(t){return null===n?void 0:n[i]},e.isPostIdLast=function(t){return null===n?!1:0===n.length?!1:n[n.length-1].id===t},e.nextPostHeadsForRange=function(t,o){if(null===n)return void 0;var r=0;if(t)for(var i=0;i<n.length;i++)if(n[i].id===t){r=i+1;break}r=Math.min(Math.max(0,r),e.count());for(var a=Math.min(Math.max(0,r+o),e.count()),u=[],i=r;a>i;i++)u.push(n[i]);return u},e.load=function(r,i){return t.stacktodo.core.jsoncors.get({url:"https://stacktodo.com/api/tool/publish/posts"+o,success:function(t,e,o){n=t.posts;for(var i=0;i<n.length;i++)n[i].index=i;r&&r()},failure:function(t,e,o){i&&i(t,e)}}),e},e.postForIndex=function(t,o,n){var r=e.postHeadForIndex(t);return e.postForId((r||{}).id,o,n)},e.postForId=function(o,n,i){if(n=n||function(){},i=i||function(){},r[o])setTimeout(function(){n(r[o])},1);else{var a=e.postHeadForId(o);void 0===a?setTimeout(function(){i(-1,"IndexNotLoadedError")}):t.stacktodo.core.ajax.get({url:a.url+"?ts="+(new Date).getTime(),success:function(t,e,u){try{t=JSON.parse(t)}catch(s){return void i(-1,"JSONParseError")}t.id=a.id,t.url=a.url,t.index=a.index,r[o]=t,n(t)},failure:function(t,e,o){i(t,e)}})}return e},e.postset=function(t,o,n,r){n=n||function(){},r=r||function(){};var i=e.nextPostHeadsForRange(t,o);if(void 0===i)setTimeout(function(){r(-1,"IndexNotLoadedError")});else if(0===i.length)setTimeout(function(){n({})});else{for(var a=!1,u={},s=0;s<i.length;s++)u[i[s].id]=null;for(var s=0;s<i.length;s++)!function(t,o){e.postForId(t,function(e){if(!a){u[t]=e;for(var o in u)if(null===u[o])return;n(u)}},function(t,e){a||(a=!0,r(t,e))})}(i[s].id,i[s].url)}return e},e.invalidatePost=function(t){return delete r[t],e},e.invalidatePosts=function(){return r={},e},e.invalidateIndex=function(){return n=null,e},e};t.stacktodo=t.stacktodo||{},t.stacktodo.SlackPublish=e}(window);