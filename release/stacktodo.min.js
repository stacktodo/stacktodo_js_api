/**
* Stacktodo JavaScript API. Version 0.0.1.
* https://github.com/stacktodo/stacktodo_js_api
* MIT License
*/
!function(t){var e=function(){var t=this;t.get=function(t){t={url:t.url||window.location.href,success:t.success||function(){},failure:t.failure||function(){},complete:t.complete||function(){}};var e;return"undefined"!=typeof XDomainRequest?(e=new XDomainRequest,e.open("GET",t.url)):(e=new XMLHttpRequest,e.open("GET",t.url,!0)),e.onload=function(){e.status>=200&&e.status<=299?t.success(e.responseText,e.status,e):t.failure(e.status,e.responseText,e),t.complete()},e.onerror=function(){t.failure(e.status,void 0,e),t.complete()},e.send(),e}};t.stacktodo=t.stacktodo||{},t.stacktodo.core=t.stacktodo.core||{},t.stacktodo.core.ajax=new e}(window),function(t){var e=function(){var t=this;return t.serialize=function(t){for(var e={},o={input:t.getElementsByTagName("input"),textarea:t.getElementsByTagName("textarea"),select:t.getElementsByTagName("select")},n=0;n<o.input.length;n++){var r=o.input[n].name;if(void 0!==r&&0!==r.length){var a=o.input[n].type;"checkbox"===a?o.input[n].checked&&(e[r]=e[r]||[],e[r].push(o.input[n].value)):"radio"===a?o.input[n].checked&&(e[r]=e[o.input[n].value]):(e[r]=e[r]||[],e[r].push(o.input[n].value))}}for(var i=0;i<o.textarea.length;i++){var r=o.textarea[i].name;void 0!==r&&0!==r.length&&(e[r]=e[r]||[],e[r].push(o.textarea[i].value))}for(var u=0;n<o.select.length;u++){var r=o.select[u].name;if(void 0!==r&&0!==r.length)for(var s=o.select[u].getElementsByTagName("option"),c=0;c<s.length;c++)if(s[c].selected){e[r]=e[r]||[],e[r].push(s[c].value);break}}for(var l in e)1===e[l].length&&(e[l]=e[l][0]);return e},t};t.stacktodo=t.stacktodo||{},t.stacktodo.core=t.stacktodo.core||{},t.stacktodo.core.form=new e}(window),function(t){var e=function(){var t=this,e="withCredentials"in new XMLHttpRequest||"undefined"!=typeof XDomainRequest,o=function(t){var e=[];for(var o in t)e.push(encodeURIComponent(o)+"="+encodeURIComponent(t[o]));return e.join("&")};return t.requestCORS=function(t,e,o,n,r){e=e.toUpperCase();var a;return"undefined"!=typeof XDomainRequest?(a=new XDomainRequest,a.open(e,t)):(a=new XMLHttpRequest,a.open(e,t,!0)),a.onload=function(){var t;try{t=JSON.parse(a.responseText)}catch(e){}var o=t&&void 0!==t.http_status?t.http_status:a.status;o>=200&&299>=o?n(t,o,a):r(a.status,t?t.error:void 0,a)},a.onerror=function(){r(a.status,void 0,a)},"POST"===e?(a.setRequestHeader("Content-type","application/json"),a.send(JSON.stringify(o))):a.send(),a},t.requestJSONP=function(t,e,n,r,a){e=e.toUpperCase();var i=document.createElement("script");i.type="text/javascript";var u="__jsonp_"+Math.ceil(1e4*Math.random()),s={jsonp:!0,id:u,response:void 0};window[u]=function(t){i.parentElement.removeChild(i),delete window[u],s.response=t,void 0===t||null===t?r(void 0,200,s):t.http_status>=200&&t.http_status<=299?r(t,t.http_status,s):a(t.http_status,t.error,s)},i.onerror=function(){i.parentElement.removeChild(i),s.jsonp_transport_error="ScriptErrorFailure",a(0,void 0,s)};var c;return c="POST"===e?"?"+o(n)+"&callback="+u+"&_="+(new Date).getTime():"?callback="+u+"&_="+(new Date).getTime(),i.src=t+c,document.head.appendChild(i),s},t.get=function(o){var n=e?"requestCORS":"requestJSONP";return t[n](o.url||window.location.href,"GET",void 0,function(t,e,n){o.success&&o.success(t,e,n),o.complete&&o.complete()},function(t,e,n){o.failure&&o.failure(t,e,n),o.complete&&o.complete()})},t.post=function(o){var n=e?"requestCORS":"requestJSONP";return t[n](o.url||window.location.href,"POST",o.payload||{},function(t,e,n){o.success&&o.success(t,e,n),o.complete&&o.complete()},function(t,e,n){o.failure&&o.failure(t,e,n),o.complete&&o.complete()})},t};t.stacktodo=t.stacktodo||{},t.stacktodo.core=t.stacktodo.core||{},t.stacktodo.core.jsoncors=new e}(window),function(t){var e=function(e){var o=this;return o.ERRORS={EmptyFormError:"EmptyFormError",UnknownFormError:"UnknownFormError",UnknownError:"UnknownError"},o.HUMANIZED_ERRORS={EmptyFormError:"Looks like you forgot to complete the form. Can you check it and try again?",UnknownFormError:"We couldn't find the form channel you're trying to send to :-(",UnknownError:"Something went wrong and we're not quite sure what. We'll look into it as soon as possible!"},o.humanizeError=function(t){return o.HUMANIZED_ERRORS[t]||o.HUMANIZED_ERRORS.UNKNOWN_ERROR},o.preValidate=function(t){for(var e in t)return null;return o.ERRORS.EmptyFormError},o.submit=function(n,r,a,i){r=r||function(){},a=a||function(){},i=i||function(){};var u=t.stacktodo.core.form.serialize(n),s=o.preValidate(n);null===s?t.stacktodo.core.jsoncors.post({url:"https://stacktodo.com/api/tool/form/submit",payload:{id:e,form:u},success:function(t,e,o){r(),i()},failure:function(t,e,n){if(!e)switch(t){case 404:e=o.ERRORS.UnknownFormError;break;default:e=o.ERRORS.UnknownError}a(e),i()}}):(a(s),i())},this};t.stacktodo=t.stacktodo||{},t.stacktodo.SlackForm=e}(window),function(t){var e=function(e){var o=this;o.ERRORS={MissingEmailError:"MissingEmailError",InvalidEmailError:"InvalidEmailError",UnknownTeamError:"UnknownTeamError",UnknownError:"UnknownError"},o.STATUSES={RequestedAuthState:"RequestedAuthState",InvitedUserState:"InvitedUserState"},o.HUMANIZED_ERRORS={MissingEmailError:"Your email is looking awfully blank, if you fill it in we can get you started",InvalidEmailError:"Your email doesn't quite look right. Can you check it and try again?",UnknownTeamError:"We couldn't find the team you're trying to join :-(",UnknownError:"Something went wrong and we're not quite sure what. We'll look into it as soon as possible!"},o.HUMANIZED_STATUSES={RequestedAuthState:"Awesome your email address has been sent for approval. You should receive an invitation email from slack once you've been approved",InvitedUserState:"Awesome you've been invited into the team. Check your inbox for the invitation email from slack!"},o.humanizeError=function(t){return o.HUMANIZED_ERRORS[t]||o.HUMANIZED_ERRORS.UNKNOWN_ERROR},o.humanizeStatus=function(t){return o.HUMANIZED_STATUSES[t]||o.HUMANIZED_ERRORS.UNKNOWN_ERROR},o.preValidate=function(t){return t&&0!==t.length?-1===t.indexOf("@")||t.length<7?o.ERRORS.InvalidEmailError:null:o.ERRORS.MissingEmailError};var n=function(t,e){for(var o in e)t[o]=e[o];return t};return o.join=function(r,a,i,u,s){i=i||function(){},u=u||function(){},s=s||function(){};var c=o.preValidate(r);null===c?t.stacktodo.core.jsoncors.post({url:"https://stacktodo.com/api/tool/invite/join",payload:n(a,{email:r,team:e}),success:function(t,e,o){i(t.state),s()},failure:function(t,e,n){if(!e)switch(t){case 404:e=o.ERRORS.UnknownTeamError;break;default:e=o.ERRORS.UnknownError}u(e),s()}}):(u(c),s())},o};t.stacktodo=t.stacktodo||{},t.stacktodo.SlackInvite=e}(window),function(t){var e=function(){var e=this,o=function(t){switch(t.length){case 1:return"?id="+encodeURIComponent(t[0]);case 2:return"?team="+encodeURIComponent(t[0])+"&reference="+encodeURIComponent(t[1]);default:throw"InitializationError : Incorrect params"}}(Array.prototype.slice.call(arguments)),n=null,r={};return e.loaded=function(){return null!==n},e.count=function(){return null===n?void 0:n.length},e.urlAt=function(t){return null===n?void 0:n[t]},e.load=function(r,a){return t.stacktodo.core.jsoncors.get({url:"https://stacktodo.com/api/tool/publish/posts"+o,success:function(t,e,o){n=t.posts,r&&r()},failure:function(t,e,o){a&&a(t,e)}}),e},e.post=function(o,n,a){if(n=n||function(){},a=a||function(){},r[o])setTimeout(function(){n(r[o])},1);else{var i=e.urlAt(o);void 0===i?setTimeout(function(){a(-1,"IndexNotLoadedError")}):t.stacktodo.core.ajax.get({url:i+"?ts="+(new Date).getTime(),success:function(t,e,i){try{t=JSON.parse(t)}catch(u){return void a(-1,"JSONParseError")}t.html=t.html.replace(/<script\b[^<]*(?:(?!<\/script>)<[^<]*)*<\/script>/gi,""),r[o]=t,n(t)},failure:function(t,e,o){a(t,e)}})}return e},e.postset=function(t,o,n,r){if(n=n||function(){},r=r||function(){},t=Math.min(Math.max(0,t),e.count()),o=Math.min(Math.max(0,o),e.count()),0===t&&0===o)return void n({});if(t===e.count()&&o===e.count())return void n({});for(var a=!1,i={},u=t;o>u;u++)i[u]=null;for(var u=t;o>u;u++)!function(t){e.post(t,function(e){if(!a){i[t]=e;var o=!1;for(var r in i)if(null===i[r]){o=!0;break}o||n(i)}},function(t,e){a||(a=!0,r(t,e))})}(u)},e};t.stacktodo=t.stacktodo||{},t.stacktodo.SlackPublish=e}(window);